#include<iostream.h>
#include<ctype.h>
#include<conio.h>
#include<stdio.h>
#include<stdlib.h>
#include<process.h>
#include<string.h>
#include<fstream.h>
#include<iomanip.h>
int n=0;
int m=0;

void updatemaster(char);
class date                  //date
		{
		public:
		int dd,mm,yyyy;

		void accept()
		{
		char ch;
		cout<<">  |  |    <";
		cout<<"\b\b\b\b\b\b\b\b\b\b\b";
		ch=getche();
		dd=10*caze(ch);
		ch=getche();
		dd+=caze(ch);
		cout<<"|";
		ch=getche();
		mm=10*caze(ch);
		ch=getche();
		mm+=caze(ch);
		cout<<"|";
		ch=getche();
		yyyy=1000*caze(ch);
		ch=getche();
		yyyy+=100*caze(ch);
		ch=getche();
		yyyy+=10*caze(ch);
		ch=getche();
		yyyy+=caze(ch);
		cout<<"<";
		getch();
		}
		int caze(char ch)
		{
		if (ch=='1')return 1;
		else if(ch=='2')return 2;
		else if(ch=='3')return 3;
		else if(ch=='4')return 4;
		else if(ch=='5')return 5;
		else if(ch=='6')return 6;
		else if(ch=='7')return 7;
		else if(ch=='8')return 8;
		else if(ch=='9')return 9;
		else if(ch=='0')return 0;
		else return 0;
		}
		void display()
		{
		cout<<setw(2)<<dd<<"|"<<setw(2)<<mm<<"|"<<setw(4)<<yyyy;
		}
		};

//      ***************          administrator class   *****************
class admin
 {
   long double lprofit_p,lprofit_h,lprofit_r,lprofit;
   date today;
   public:

 admin()                     //constructor
 {
 lprofit=0.0;
 }
 void showdate()
 {
 today.display();
 }
 void setdate()
 {
 today.accept();
 updatemaster('w');
 }
 date getdate()
 {
 return today;
 }
 void profit(int data,char* title,char c)
 {
   if(c=='p')                //if profit is due to penalty, data=days after renewal
   {
   lprofit_p+=data*10;
   lprofit+=data*10;
   cout<<"\nPenalty charge of Rs."<<data*10<<" was deducted for having the CD - "<<title;
   cout<<endl<<" for "<<data<<" days after the date of renewal.\n\n";
   }
   else if(c=='h')           //if profit is due to hiring, data=cost of cd
   {
   lprofit_h+=data/2.0;
   lprofit+=data/2.0;
   cout<<"\n hiring cost of Rs. "<<data/2.0<<" was deducted. Original cost of the cd is Rs."<<data<<endl;
   }
   else if(c=='r')           //if profit is due to registration fee(Advance),data=registration fee
   {
   lprofit_r+=data;
   lprofit+=data;
   cout<<"\n\n\tThanks for registering with us , "<<title;
   cout<<"\n\n\tAs a part of our Registration process,\n\tAn advance fee of Rs. "<<data<<" was deducted\n\n";
   cout<<"\n\tRegards,\n\tTeam Cd library";
   }
  updatemaster('w');
 }

 void showprofit()
 {
 cout<<"---------------                                            "<<endl;
 cout<<"   Profit  :                                               "<<endl;
 cout<<"---------------                                            "<<endl<<endl;
 cout<<"  --->  Profit produced from registration                 :  "<<lprofit_r<<endl;
 cout<<"                                                           "<<endl;
 cout<<"  --->  Profit produced from hiring                       :  "<<lprofit_h<<endl;
 cout<<"                                                           "<<endl;
 cout<<"  --->  Profit produced from penalties                    :  "<<lprofit_p<<endl;
 cout<<"                                                            ------------"<<endl;
 cout<<"                                       Total profit       :  "<<lprofit<<endl;
 cout<<"                                                            ------------"<<endl<<endl;
 cout<<"     The lifetime profit generated by Cd library is "<<lprofit<<endl;
 }




}master;

class store
{
private:
	char name[100],address[100],eid[50],phno[15],uid[15];
	char temp1[20],temp2[20],pin[20];


		int validate(char,char*);  //prototype for form validation
		void generate();            //prototype for generating uid
		void passgen();             //prototype for generating pin
		date dob;


		char* expand(char);

		void invalid(char ch)
		{if(ch=='n')
		 cout<<"\n\t\t\tInvalid (only alphabets)";
		 else if(ch=='a')
		 cout<<"\n\t\t\tInvalid (no special charchters except , and .)";
		 else if(ch=='e')
		 cout<<"\n\t\t\tEmail id is invalid";
		 else if(ch=='p')
		 cout<<"\n\t\t\tEnter a valid phone no.";
		}
public:
	void acceptpart(char);     //for display after validation
	int diff(date,date);       //prototype for diff function
	void edit();               //prototype for edit function
	char deactivate,borrow[50];
	date bdate,rdate;
	char* retname()
	{return name;
	}
	char* retpin()
	{return pin;
	}
	char* retuid()
	{return uid;
	}
	void accept()
	{strcpy(borrow,"[~~NULL~~]");
	 deactivate='n';
	 cout<<endl;
	 cout<<"\t\t\tName                :";
	 gets(name);
	 if(validate('n',name)==0)
	 {
	 invalid('n');
	 getch();
	 acceptpart('n');
	 }
	 cout<<"\t\t\tAddress             :";
	 gets(address);
	 if(validate('a',address)==0)
	 {
	 invalid('a');
	 getch();
	 acceptpart('a');
	 }
	 cout<<"\t\t\tEmail id            :";
	 gets(eid);
	 if(validate('e',eid)==0)
	 {
	 invalid('e');
	 getch();
	 acceptpart('e');
	 }
	 passgen();
	 cout<<"\t\t\tEnter phone number  :";
	 gets(phno);
	 if(validate('p',phno)==0)
	 {
	 invalid('p');
	 getch();
	 acceptpart('p');
	 }
	 cout<<"\t\t\tEnter date of birth :";
	 dob.accept();
	 clrscr();
	 generate();
	 master.profit(500,name,'r');
	 getch();
	}
	void display(char usr='m')
	{if(usr=='m')
	 {
	 cout<<"\t\t  "<<"________________________________________"<<endl;
	 cout<<endl<<"\t\t\t      "<<"Home page!!"<<endl;
	 cout<<"\t\t  "<<"________________________________________"<<endl<<endl;
	 cout<<"\t\tYour account details    :"<<endl<<endl;
	 }
	 cout<<"\t\t\tName          :"<<name<<endl;
	 cout<<"\t\t\tAddress       :"<<address<<endl;
	 cout<<"\t\t\tEmail id      :"<<eid<<endl;
	 if(usr=='e')
	 cout<<"\t\t\tPassword      :"<<"*****"<<endl;
	 cout<<"\t\t\tPhone number  :"<<phno<<endl;
	 cout<<"\t\t\tDate of birth :";
	 dob.display();
	}

}s;
		 /*------------------------------------------------------
			Function enables short hand notations in code
		 ------------------------------------------------------*/

char* store::expand(char ch)
		{
		if(ch=='n')
		return name;
		if(ch=='a')
		return address;
		if(ch=='e')
		return eid;
		if(ch=='p')
		return phno;
		return "[~~NULL~~]";
		}
		/*------------------------------------------------------
			      Function for form validation
				  during registration
		 ------------------------------------------------------*/

int store::validate(char ch,char *a)
{
       switch(ch)
	{case 'n':{
		  for(int i=0;a[i]!='\0';i++)
		   {
		   if((isalpha(a[i])||(a[i]==' '))==0)
		   return 0;
		   }
		  return 1;
		  }
	 case 'a':{
		  for(int i=0;a[i]!='\0';i++)
		   {
		   if( ( isalnum(a[i])||(a[i]==',')||(a[i]==' ')||(a[i]=='-')||(a[i]=='/')||(a[i]=='.') )==0)
		   return 0;
		   }
		  return 1;
		  }
	 case 'e':{int ctr=0,flag=0;
		   if(isdigit(a[0]))
		   return 0;
		   for(int i=0;a[i]!='\0';i++)
		   {
		   if( ( (isalnum(a[i]))||(a[i]=='@')||(a[i]=='-')||(a[i]=='_')||(a[i]=='.') )==0)
		   return 0;
		   if(a[i]=='@')
		   ctr++;
		   }
		   if(ctr!=1)
		   return 0;
		   ctr=0;
		   for(int k=0;a[k]!='\0';k++)
		    {
		      if(a[k]=='@')
			 {
			   for(int j=k+1;a[j]!='\0';j++)
			   {
			      if(a[j]=='.')
			      {
			       if(a[j+1]!='\0')
			       flag=1;
			       else
			       flag=0;
			      }
			   }
			 }
		    }
		   if(flag)
		   return 1;
		   else
		   return 0;
		  }
	 case 'p':{
		       if(!((strlen(a)>6)&&(strlen(a)<=15)))
		       return 0;
		       else
				{
				for(int i=0;a[i]!='\0';i++)
					{
					if(isdigit(a[i])==0)
					return 0;
					}
				return 1;
				}
		     }
	 case 'x':return 1;
	 default :return 5;
      }
}
	  /*------------------------------------------------------
		 Function for display/accepting user details
			while validating the form
	   ------------------------------------------------------*/


void store::acceptpart(char ch)
{ int f=0;
   while((validate(ch,expand(ch))==0)||(ch=='x'))
   {
     if(f==1)
     {
     invalid(ch);
     getch();
     }
     else
     f=1;
     clrscr();
     cout<<"\t\t  "<<"________________________________________"<<endl;
     cout<<endl<<"\t\t  "<<"          REGISTRATION PORTAL"<<endl;
     cout<<"\t\t  "<<"________________________________________"<<endl<<endl;

     if(ch=='n'||ch=='a'||ch=='e'||ch=='p'||ch=='x')
     {
     cout<<"\t\t\tName                :";
     if(ch=='n')
     gets(name);
     else
     cout<<name<<endl;
     }
     if(ch=='a'||ch=='e'||ch=='p'||ch=='x')
     {
     cout<<"\t\t\tAddress             :";
     if(ch=='a')
     gets(address);
     else
     cout<<address<<endl;
     }
     if(ch=='e'||ch=='p'||ch=='x')
     {
     cout<<"\t\t\tEmail id            :";
     if(ch=='e')
     gets(eid);
     else
     cout<<eid<<endl;
     if(ch=='x')
     return;
     }
     if(ch=='p')
     {
     cout<<"\t\t\tEnter 5 digit pin   : *****"<<endl;
     cout<<"\t\t\tRe-enter your pin   : *****"<<endl<<"passwords match"<<endl;
     cout<<"\t\t\tEnter phone number  :";
     if(ch=='p')
     gets(phno);
     else
     cout<<phno<<endl;
     }

   }


}



      /*------------------------------------------------------
	   Function for calculating no.of days btw two dates
       ------------------------------------------------------*/
int store::diff(date a,date b)
	{
	  long double totala,totalb;
	  int ydays,mdays,leap=0,gross;
	  static int mconst_leap[]  = {31,29,31,30,31,30,31,31,30,31,30,31} ;
	  static int mconst_normal[]= {31,28,31,30,31,30,31,31,30,31,30,31} ;

//---------------------------------~~for A~~--------------------------------

	    if((a.yyyy%4)==0)        //to determine if its a leap year
		{ if((a.yyyy%100)==0)
		   {  if((a.yyyy%400)==0)
		      leap=1;
		   }
		  else
		  leap=1;
		}
	    ydays=365+leap;      //no.of days obtained with correction
	    mdays=0;
	    if(leap)
	    {
	    for(int i=0;i<a.mm-1;i++)
	    mdays+=mconst_leap[i];
	    }
	    else
	    {
	    for(int i=0;i<a.mm-1;i++)
	    mdays+=mconst_normal[i];
	    }
	    totala=((a.yyyy*ydays)+(mdays)+(a.dd));
//---------------------------------~~for B~~--------------------------------
	    leap=0;
	    if((b.yyyy%4)==0)        //to determine if its a leap year
		{ if((b.yyyy%100)==0)
		   {  if((b.yyyy%400)==0)
		      leap=1;
		   }
		  else
		  leap=1;
		}
	    ydays=365+leap;      //no.of days obtained with correction
	    mdays=0;
	    if(leap)
	    {
	    for(int i=0;i<b.mm-1;i++)
	    mdays+=mconst_leap[i];
	    }
	    else
	    {
	    for(int i=0;i<b.mm-1;i++)
	    mdays+=mconst_normal[i];
	    }
	    totalb=((b.yyyy*ydays)+(mdays)+(b.dd));
	  gross=(int)(totala-totalb);
	  return gross;
}

      /*------------------------------------------------------
		 Function for editing user detatils
       ------------------------------------------------------*/


void store::edit()
    { int ctr;
      char ch;
	while(1)
	{ ctr=1;
	  ch='a';
	  clrscr();
	  cout<<"\t\t  "<<"________________________________________"<<endl;
	  cout<<endl<<"\t\t\t      "<<"Edit your profile !!"<<endl;
	  cout<<"\t\t  "<<"________________________________________"<<endl<<endl;
	  cout<<"\t\tYour account details    :"<<endl<<endl;
	  display('e');
	  cout<<"\n\tnavigate using < or > to a detail to edit it:"<<endl<<endl;

	  cout<<"\t1.Name              <==== "<<endl;
	  cout<<"\t2.Address  	             "<<endl;
	  cout<<"\t3.Email id 	             "<<endl;
	  cout<<"\t4.Password                "<<endl;
	  cout<<"\t5.Phone number            "<<endl;
	  cout<<"\t6.Date of birth           "<<endl;
	  cout<<"\t        Done              "<<endl;

	   while((int)ch!=13)
		{ ch=getch();
		  if((int)ch==13)
		  break;
		  if((int)ch==44)     //move arrow up
		  { if(ctr==1)
		    ctr=7;
		    else
		    ctr--;
		  }
		  if((int)ch==46)     //move arrow down
		  { if(ctr==7)
		    ctr=1;
		    else
		    ctr++;
		  }
		  if(ctr==1)
		  {
		  clrscr();
		  cout<<"\t\t  "<<"________________________________________"<<endl;
		  cout<<endl<<"\t\t\t      "<<"Edit your profile !!"<<endl;
		  cout<<"\t\t  "<<"________________________________________"<<endl<<endl;
		  cout<<"\t\tYour account details    :"<<endl<<endl;
		  display('e');
		  cout<<"\n\tnavigate using < or > to a detail to edit it:"<<endl<<endl;

		  cout<<"\t1.Name              <==== "<<endl;
		  cout<<"\t2.Address  	             "<<endl;
		  cout<<"\t3.Email id 	             "<<endl;
		  cout<<"\t4.Password                "<<endl;
		  cout<<"\t5.Phone number            "<<endl;
		  cout<<"\t6.Date of birth           "<<endl;
		  cout<<"\t        Done              "<<endl;
		  }
		  if(ctr==2)
		  {
		  clrscr();
		  cout<<"\t\t  "<<"________________________________________"<<endl;
		  cout<<endl<<"\t\t\t      "<<"Edit your profile !!"<<endl;
		  cout<<"\t\t  "<<"________________________________________"<<endl<<endl;
		  cout<<"\t\tYour account details    :"<<endl<<endl;
		  display('e');
		  cout<<"\n\tnavigate using < or > to a detail to edit it:"<<endl<<endl;

		  cout<<"\t1.Name                    "<<endl;
		  cout<<"\t2.Address           <==== "<<endl;
		  cout<<"\t3.Email id 	             "<<endl;
		  cout<<"\t4.Password                "<<endl;
		  cout<<"\t5.Phone number            "<<endl;
		  cout<<"\t6.Date of birth           "<<endl;
		  cout<<"\t        Done              "<<endl;
		  }
		  if(ctr==3)
		  {
		  clrscr();
		  cout<<"\t\t  "<<"________________________________________"<<endl;
		  cout<<endl<<"\t\t\t      "<<"Edit your profile !!"<<endl;
		  cout<<"\t\t  "<<"________________________________________"<<endl<<endl;
		  cout<<"\t\tYour account details    :"<<endl<<endl;
		  display('e');
		  cout<<"\n\tnavigate using < or > to a detail to edit it:"<<endl<<endl;

		  cout<<"\t1.Name                    "<<endl;
		  cout<<"\t2.Address                 "<<endl;
		  cout<<"\t3.Email id          <==== "<<endl;
		  cout<<"\t4.Password                "<<endl;
		  cout<<"\t5.Phone number            "<<endl;
		  cout<<"\t6.Date of birth           "<<endl;
		  cout<<"\t        Done              "<<endl;
		  }
		  if(ctr==4)
		  {
		  clrscr();
		  cout<<"\t\t  "<<"________________________________________"<<endl;
		  cout<<endl<<"\t\t\t      "<<"Edit your profile !!"<<endl;
		  cout<<"\t\t  "<<"________________________________________"<<endl<<endl;
		  cout<<"\t\tYour account details    :"<<endl<<endl;
		  display('e');
		  cout<<"\n\tnavigate using < or > to a detail to edit it:"<<endl<<endl;

		  cout<<"\t1.Name                    "<<endl;
		  cout<<"\t2.Address  	             "<<endl;
		  cout<<"\t3.Email id 	             "<<endl;
		  cout<<"\t4.Password          <==== "<<endl;
		  cout<<"\t5.Phone number            "<<endl;
		  cout<<"\t6.Date of birth           "<<endl;
		  cout<<"\t        Done              "<<endl;
		  }
		  if(ctr==5)
		  {clrscr();
		  cout<<"\t\t  "<<"________________________________________"<<endl;
		  cout<<endl<<"\t\t\t      "<<"Edit your profile !!"<<endl;
		  cout<<"\t\t  "<<"________________________________________"<<endl<<endl;
		  cout<<"\t\tYour account details    :"<<endl<<endl;
		  display('e');
		  cout<<"\n\tnavigate using < or > to a detail to edit it:"<<endl<<endl;

		  cout<<"\t1.Name                    "<<endl;
		  cout<<"\t2.Address  	             "<<endl;
		  cout<<"\t3.Email id 	             "<<endl;
		  cout<<"\t4.Password                "<<endl;
		  cout<<"\t5.Phone number      <==== "<<endl;
		  cout<<"\t6.Date of birth           "<<endl;
		  cout<<"\t        Done              "<<endl;
		  }
		  if(ctr==6)
		  {
		  clrscr();
		  cout<<"\t\t  "<<"________________________________________"<<endl;
		  cout<<endl<<"\t\t\t      "<<"Edit your profile !!"<<endl;
		  cout<<"\t\t  "<<"________________________________________"<<endl<<endl;
		  cout<<"\t\tYour account details    :"<<endl<<endl;
		  display('e');
		  cout<<"\n\tnavigate using < or > to a detail to edit it:"<<endl<<endl;

		  cout<<"\t1.Name                    "<<endl;
		  cout<<"\t2.Address  	             "<<endl;
		  cout<<"\t3.Email id 	             "<<endl;
		  cout<<"\t4.Password                "<<endl;
		  cout<<"\t5.Phone number            "<<endl;
		  cout<<"\t6.Date of birth     <==== "<<endl;
		  cout<<"\t        Done              "<<endl;
		  }
		  if(ctr==7)
		  {
		  clrscr();
		  cout<<"\t\t  "<<"________________________________________"<<endl;
		  cout<<endl<<"\t\t\t      "<<"Edit your profile !!"<<endl;
		  cout<<"\t\t  "<<"________________________________________"<<endl<<endl;
		  cout<<"\t\tYour account details    :"<<endl<<endl;
		  display('e');
		  cout<<"\n\tnavigate using < or > to a detail to edit it:"<<endl<<endl;

		  cout<<"\t1.Name                    "<<endl;
		  cout<<"\t2.Address  	             "<<endl;
		  cout<<"\t3.Email id 	             "<<endl;
		  cout<<"\t4.Password                "<<endl;
		  cout<<"\t5.Phone number            "<<endl;
		  cout<<"\t6.Date of birth           "<<endl;
		  cout<<"\t        Done        <==== "<<endl;
		  }

		}      //end of while ch!=13
	      //	int exit=0;
		if(ctr==1)
		{
		clrscr();
		cout<<"Enter your name          :";
		gets(name);
		}
		else if(ctr==2)
		{
		clrscr();
		cout<<"Enter your address       :";
		gets(address);
		}
		else if(ctr==3)
		{
		clrscr();
		cout<<"Enter your email address :";
		gets(eid);
		}
		else if(ctr==4)
		{
		clrscr();
		passgen();
		}
		else if(ctr==5)
		{
		clrscr();
		cout<<"Enter your phone number  :";
		gets(phno);
		}
		else if(ctr==6)
		{
		clrscr();
		dob.accept();
		}
		else if(ctr==7)
		{
		clrscr();
		return;
		}



	}       //end of while(1)
    }           //end of edit
     /*------------------------------------------------------
		 Function for generating user id (uid)
       ------------------------------------------------------*/


void store::generate()
	{  clrscr();
	   cout<<"\t\t  "<<"_____________________________________________"<<endl;
	   cout<<endl<<"\t\t\t  "<<"Your user name has been created !!"<<endl;
	   cout<<"\t\t  "<<"_____________________________________________"<<endl;


	   for(int i=0;i<3;i++)
		uid[i]=name[i];

	   for(int j=3;j<=9;j++)
		uid[j]=phno[j];
	   uid[j]='\0';
	 cout<<"your user id is :"<<uid;

	}

     /* -----------------------------------------------
	      Function for generating password
	-----------------------------------------------*/

void store::passgen()
 { int flag=0;
    while(!flag)
    { // Enter password
      cout<<"\t\t\tEnter 5 digit pin   : ";
      for(int i=0;i<5;i++)
      {
      temp1[i]=getch();
      if((int)temp1[i]==8)        ////////////////////////////////////////
      {                           // This statement gives compatability //
	if(i>0)                   //          for backspaces            //
	{                         ////////////////////////////////////////
	 cout<<"\b \b";
	 i--;             // To delete the previous charachter
	}
      i--;                // Cursor must not be moved if backspace is entered
      }
      else
      cout<<"*";
      }
      temp1[i]='\0';
      // Re-enter password
      cout<<endl;
      cout<<"\t\t\tRe-enter your pin   : ";
      for(i=0;i<5;i++)
      {
      temp2[i]=getch();

      if((int)temp2[i]==8)        ////////////////////////////////////////
      {                           // This statement gives compatability //
	if(i>0)                   //          for backspaces            //
	{                         ////////////////////////////////////////
	 cout<<"\b \b";
	 i--;             // To delete the previous charachter
	}
      i--;                // Cursor must not be moved if backspace is entered
      }
      else
      cout<<"*";
      }
      temp2[i]='\0';



   //if passwords match continue else quit
   if(strcmpi(temp1,temp2)==0)
   {
   flag=1;
   cout<<endl<<"\t\t\t"<<"password match"<<endl;
   strcpy(pin,temp1);
   }
   else
   {
   cout<<endl<<"\t\t\t"<<"passwords do not match";
   getch();
   acceptpart('x');
   }
  }
 }


//                       *** End of Class definition ***
/*_______________________________~~~for store~~~___________________________
  _________________________________________________________________________*/




class music
{
	char album[40];
	char artist[40];
	char genre[20];
	char year[4];
	char comments[50];
	int  rating;
	char sid[40];
public:
	float cost;
	char cflag;
	char s[30];      //name of the song
	void accept() ;
	void display();
	char* retmid()
	{
	return sid;
	}
}song;
			 ////////////////////////////
			 //  function definitions  //
			 ////////////////////////////
void music::accept()
{
  cout<<"\nEnter the song title          :";
  gets(s);
  cout<<"\nEnter the name of the artist  :";
  gets(artist);
  cout<<"\nEnter the album name          :";
  gets(album);
  cout<<"\nEnter the genre of the song   :";
  gets(genre);
  cout<<"\nEnter the year it came out    :";
  gets(year);
  cout<<"\nUse < or > to rate the song   :";
  int old,ctr=1;
  char ch;
  cout<<"\3 ";
  while((int)ch!=13)
  { old=ctr;
    ch=getch();
    if((int)ch==13)
    break;
    if((int)ch==44)     //-1 rating
    { if(ctr==1)
      ctr=5;
      else
      ctr--;
    }
    if((int)ch==46)     //+1 rating
    { if(ctr==5)
      ctr=1;
      else
      ctr++;
    }
   for(int i=1;i<=old;i++)
   cout<<"\b\b \b";
   for(i=1;i<=ctr;i++)
   cout<<"\3 ";
  }
  rating=ctr;
  cout<<"\nEnter the price of the cd     :";
  cin>>cost;
  cout<<"\nAny comments ?? (y/n)         :";
  cin>>cflag;
  if(cflag=='y')
  {
  cout<<"\nEnter any comments            :";
  gets(comments);
  }

}
void music::display()
//FUNCTION TO DISPLAY SONG DETAILS
{
  cout<<"\nDISPLAYING SONG DETAILS"<<endl;
  cout<<  "SONG TITLE     : ";
  puts(s);
  cout<<"\nARTIST         : ";
  puts(artist);
  cout<<"\nALBUM          : ";
  puts(album);
  cout<<"\nGENRE          : ";
  puts(genre);
  cout<<"\nRATING         : ";
  for(int i=0;i<rating;i++)
  cout<<"\3 ";
  cout<<"( "<<i<<" stars )";
  cout<<"\nYEAR           : ";
  cout<<year;
  cout<<"\nCOST           : ";
  if(cflag=='y')
  {
  cout<<"\nCOMMENTS       : ";
  puts(comments);
  }
  getch();
}
//                       *** End of Class definition ***
/*_______________________________~~~for music~~~___________________________
  _________________________________________________________________________*/



void updatemaster(char ch)
{
fstream a;
a.open("master.dat",ios::binary|ios::in|ios::out);
 if(ch=='w')
 {
 a.seekp(0);
 a.write((char*)&master,sizeof(master));
 }
 else if(ch=='r')
 {
 a.seekg(0);
 a.read((char*)&master,sizeof(master));
 }
 a.close();
}


void obtain()
{
cout<<setiosflags(ios::left);
updatemaster('r');
music temp1;
store temp;
fstream a;
a.open("users.dat",ios::binary|ios::in);
a.seekg(0,ios::end);
n=a.tellg()/sizeof(temp);
a.close();
a.open("music.dat",ios::binary|ios::in);
a.seekg(0,ios::end);
m=a.tellg()/sizeof(temp1);
a.close();
}


void mask(char* a,char f='n',int flag=1,int del=0)
{  if(flag==1)
   {int l=strlen(a);
    if(l<=15)                             /////////////////////////////////////
    {cout<<"\t\t\t|"<<a;                  //   Note :-                       //
     for(int i=1;i<=15-l;i++)             //                                 //
     cout<<" ";                           //  1. a is the 2-D arrray which   //
     cout<<"|";                           //                                 //
     if(f=='y')                           //     contains the sorted array   //
     cout<<" \t<====     |\n";            //     having search instants.     //
     else                                 //                                 //
     cout<<" \t          |\n";            //  2. f a is flag variable which  //
    }                                     //     prints the arrow and checks //
    if(l>15)                              //     the parameter(song in this  //
    {                                     //     case)which is currently     //
     cout<<"\t\t\t|";                     //     navigated through.          //
     for(int i=0;i<12;i++)                //                                 //
     cout<<a[i];                          //  3. flag is a flag variable     //
     cout<<"...|";                        //     which tells the mask() fn.  //
     if(f=='y')                           //     if the user is a member or  //
     cout<<" \t<====     |\n";            //     administrator.              //
     else                                 //                                 //
     cout<<" \t          |\n";            //  4. del tells the function if   //
    }                                     //     the admin wants a user      //
   }                                      //     interface suitable for      //
   else if(flag==0)                       //     deletion or not.            //
   {                                      /////////////////////////////////////
    int l=strlen(a);
    if(l<=15)
    {if(del==1)
     cout<<"\t\t|   X   |\t"<<a;
     else if(del==0)
     cout<<"\t\t|       |\t"<<a;
     for(int i=1;i<=15-l;i++)
     cout<<" ";
     if(f=='y')
     cout<<"     |  <====      |\n";
     else
     cout<<"     |             |\n";
    }
    if(l>15)
    {if(del==1)
     cout<<"\t\t|   X   |\t";
     else if(del==0)
     cout<<"\t\t|       |\t";
     for(int i=0;i<12;i++)
     cout<<a[i];
     cout<<"...";
     if(f=='y')
     cout<<"     |  <====      |\n";
     else
     cout<<"     |             |\n";
    }
   }
}

void dplay(char  a[50][50],int k)
{
cout<<endl;
for(int i=0;i<k;i++)
cout<<a[i]<<endl;
}

void delstring(char a[50][50],char* ele,int &n)
{int f=0,pos;
 if(n==0)
 {
 cout<<"underflow";
 return;
 }
 for(int i=0;i<n;i++)
 {
  if(strcmpi(a[i],ele)==0)
  {pos=i;
   f++;
  }
  if(f!=0)
  break;
 }
 for(i=pos;i<(n-1);i++)
 strcpy(a[i],a[i+1]);
 n--;
}


void msave(music temp)
{
     ofstream a("music.dat",ios::app|ios::binary);
     a.write((char*)&temp,sizeof(temp));
     a.close();
     m++;
}


void save(store temp)
{
 fstream a;
 a.open("users.dat",ios::binary|ios::app);
 a.write((char*)&temp,sizeof(temp));
 a.close();
 n++;
}
void rewrite(store x,int pos)
{ fstream y;
  y.open("users.dat",ios::binary|ios::in|ios::out);
  if(!y)
  cout<<"error....... Could not open the file..............\n";
  else
  {
  y.seekp(0);
  pos-=sizeof(x);
  y.seekp(pos,ios::beg);
  y.write((char*)&x,sizeof(x));
  y.close();
  cout<<"\n Updated succesfully";
  }
}
/*____________________________________________________________________________
  ____________________________________________________________________________

	    /*-----------------------------------------------------
				 Search Engine
	    -----------------------------------------------------*/
char ret;
int f;
char del[50][50],mreturn[50]="[~~NULL~~]";
int delflag=0,reverse=0,delctr=0;

 void search(char* search,char u='u')
{

char result[50][50],ch;
music temp1;
int avoid=0;
int isize;                 //size of the current search-word
int ctr1=0;
int tracker=0,flag=1;
fstream a;
char temp[50];

 isize=strlen(search);
 a.open("music.dat",ios::in|ios::binary);
 while(!a.eof())             //  opens stored songs one by one
  { flag=1;
    a.read((char*)&temp1,sizeof(temp1));
    if(a.eof()==1)
    break;
    else



	/*-----------------------------------------------------------------
	    From here onwards each song is considered as a search instant
	  -----------------------------------------------------------------*/

			 ////////////////////////////////
			 //  Starts the linear search  //
			 ////////////////////////////////

    for(int i=0;(i<isize)&&(isize>0);i++) // matches the song typed and search instant
			     // letter by letter (for 1 song)
    {

      if(flag)
      {
	 if(temp1.s[i]==search[i])
	 flag=1;

	 else
	 flag=0;

	 if(flag==0)
	 break;
      }
      else
      break;

    }
    if(flag==1)
    {
      strcpy(result[ctr1],temp1.s);
      ctr1++;        // counts the number of instants
		     //(note :- number not index)
    }

  }                 // end of while loop
 a.close();         //closed the fstream object

/*--------------------------------------------------------------------------
   ( Now all instants are scaned and stored in the resultant 2-D array)
  --------------------------------------------------------------------------*/

      //////////////////////////////////////////////////////////////////
      //   Uses bubble sort to sort the instants in dictionary order  //
      //////////////////////////////////////////////////////////////////

  // ~~~~Bsort
  for(int i=0; i<ctr1; i++)
  { for(int j=0; j<ctr1-1-i; j++)
     { if(strcmpi(result[j],result[j+1])>0)
       { strcpy(temp,result[j]);
	strcpy(result[j],result[j+1]);
	strcpy(result[j+1],temp);
       }
     }
  }

  if(u=='a')
  {
  strcpy(result[ctr1],"[~~DELETE~~]");
  ctr1++;
  }
/*---------------------------------------------------------------------------
	  Now we have the instants sorted and ready to be displayed
  ---------------------------------------------------------------------------*/

  int ctrg=0;                       //counter for gui
  if(ctr1>=1)
  {
  clrscr();
  cout<<"\t\t  "<<"    ________________________________________"<<endl;
  cout<<endl<<"\t\t\t          "<<search<<"_"<<endl;
  cout<<"\t\t  "<<"    ________________________________________"<<endl<<endl;
  cout<<"navigate using < or > keys...\n";
  if(u=='u')
  {
  cout<<"\t\t        |---------------|-----------------|\n";
  cout<<"\t\t        |     Title     |     Select:     |\n";
  cout<<"\t\t        |---------------|-----------------|\n";
  mask(result[0],'y');
  for(int e=1;e<ctr1;e++)
  mask(result[e]);
  cout<<"\nSelected song is :"<<result[tracker];
  }
  else if(u=='a')
  {
  cout<<"\t\t|-------------------------------------------------|\n";
  cout<<"\t\t|               Batch delete songs                |\n";
  cout<<"\t\t|-------|---------------------------|-------------|\n";
  cout<<"\t\t| mark: |  \t   TITLE            |\t Select : |\n";
  cout<<"\t\t|-------|---------------------------|-------------|\n";
  mask(result[0],'y',0);
  for(int e=1;e<ctr1;e++)
  mask(result[e],'n',0);

  }
  }
  else
  cout<<"NO songs found !!!";
  ch=getch();
  if((int)ch==13||(int)ch==44||(int)ch==46)//enters the navigation menu
  {     flag=0;
      while(1)
       {if(u=='a')                    // !!!!!! Check for error !!!!!!
	     if((int)ch==13)
		 if(ctrg==((ctr1)-1)) //if index of hovered option=last option (i.e [~~DELETE~~])
		    break;            //then break the loop
	  if(flag==1)
	  ch=getch();
	  else
	  flag=1;


	 if((int)ch==13||(int)ch==44||(int)ch==46)
	 {     if(u=='u')
	       if((int)ch==13)
		break;

	       if(u=='a')
	       if((int)ch==13)
	       {
		if(ctrg==((ctr1)-1))
		{
		delflag=0;
		delctr++;
		}
		else
		delflag=1;
	       }
		if((int)ch==44)     //move arrow up
		 { if(ctrg==0)
		   ctrg=(ctr1-1);
		   else
		   ctrg--;
		 }
		if((int)ch==46)     //move arrow down
		 { if(ctrg==(ctr1-1))
		   ctrg=0;
		   else
		   ctrg++;
		 }


	      clrscr();
	      cout<<"\t\t  "<<"    ________________________________________"<<endl;
	      cout<<endl<<"\t\t\t          "<<search<<"_"<<endl;
	      cout<<"\t\t  "<<"    ________________________________________"<<endl<<endl;
	      cout<<"navigate using < or > keys...\n";


	      if(u=='u')
	      {
	      cout<<"\t\t        |---------------|-----------------|\n";
	      cout<<"\t\t        |     Title     |     Select:     |\n";
	      cout<<"\t\t        |---------------|-----------------|\n";
	      }
	      if(u=='a')
	      {
	      cout<<"\t\t|-------------------------------------------------|\n";
	      cout<<"\t\t|               Batch delete songs                |\n";
	      cout<<"\t\t|-------|---------------------------|-------------|\n";
	      cout<<"\t\t| mark: |  \t   TITLE            |\t Select : |\n";
	      cout<<"\t\t|-------|---------------------------|-------------|\n";
	      }
	      for(int i=0;i<ctr1;i++)
	      {
		    if(i==ctrg)
		    { //cout<<"delfa
		      tracker=ctrg;	       //tracker stores the index of hovered song
		      if(u=='u')
			mask(result[i],'y');
		      if(u=='a')
		       {             //to avoid incrementation of already initialised array wiht the current option

			 for(int j=0;j<delctr;j++)
			 {

			   reverse=delflag;
			   if(strcmpi(del[j],result[i])==0)  //if song is already marked
			   {
			    delflag=1;
			    if(reverse==delflag)
			    {delstring(del,del[j],delctr);
			    delflag=0;
			    }
			    else if(reverse!=delflag)
			    avoid=1;
			    break;
			   }
			 }


			mask(result[i],'y',0,delflag);
			if(delflag==1)
			{
			 if(avoid==0)            //if the song in newly marked
			 {
			  strcpy(del[delctr],result[i]);
			  delctr++;
			 }
			 else
			 avoid=0;
			 delflag=0;
			}

		       }  //end of if u==a
		    }     //end of if i==ctrg
		    else
		    {
		    if(u=='a')
		    {

		    int flg=0;

		    for(int j=0;j<delctr;j++)
			 {
			  if(strcmpi(del[j],result[i])==0)
			  {
			  flg=1;
			  break;
			  }
			 }

		    mask(result[i],'n',0,flg);
		    flg=0;
		    }
		    if(u=='u')
		    mask(result[i]);
		    }
	      }              //end of for loop


	 }                   //end of if (inner)
	 else                //else corresponding to inner if statement
	 {
	  ret=ch;
	  f=0;
	  return;
	 }
	 if(u=='u')
	 cout<<"\nSelected song is :"<<result[tracker];

	 }                    //end of while  ch!=13

	     if(u=='u')
	     {
		a.open("music.dat",ios::in|ios::binary);
		while(!a.eof())
		{
		    a.read((char*)&temp1,sizeof(temp1));
		    if(a.eof()==1)
		    break;
		    if( strcmpi(temp1.s,result[tracker])==0)
		    {
		    strcpy(mreturn,temp1.s);
		    master.profit(temp1.cost,temp1.s,'h');
		    temp1.display();
		    break;
		    }

		}
		a.close();
		getch();
	     }
	     else if(u=='a')
	     {
	     int xflag=0;
	     music xtemp;
	     fstream a,b;
	     a.open("music.dat",ios::binary|ios::in);
	     b.open("temp.dat",ios::binary|ios::out);
	     dplay(del,delctr);
	     while(!a.eof())
	     {
	      a.read((char*)&xtemp,sizeof(xtemp));
	      if(a.eof()==1)
	      break;
	      else
	      {
	       for(int i=0;i<delctr;i++)
	       {
		if(strcmpi(del[i],xtemp.s)==0)
		{
		xflag=1;
		}
	       }

	       if(xflag==0)
	       {
	       b.write((char*)&xtemp,sizeof(xtemp));
	       }

	      }
	     }
	     a.close();
	     b.close();
	     delete("music.dat");
	     rename("temp.dat","music.dat");
	     cout<<"\nDeleted the songs.\n";
	     getch();
	     }
   f=1;
   return;
  }                        //end of if(outer)
  else
  {
  ret=ch;
  f=0;
  return;
  }

}
/*____________________________________________________________________________
  ____________________________________________________________________________

	    /*-----------------------------------------------------
		 Function to perform tasks on existing users
	    -----------------------------------------------------*/

void existing(char* id,char* pass)
{       char ch,sch[50],borrow[50];
	store temp;
	int flag=0;
	clrscr();
	fstream a;
	a.open("users.dat",ios::binary|ios::in);

	if(n!=0)
	{
	while(!a.eof())
	{
	a.read((char*)&temp,sizeof(temp));
	if(a.eof()==1)
	    {
		a.close();
		return;
		}
	if(( strcmpi(temp.retuid(),id)==0)&&(strcmp(temp.retpin(),pass)==0))
	  while(1)
	  {char ch;
	   int choice,ctr=1,choice1,ctr1=1;
	    flag++;
	    temp.display();

		ch='a';  //This can be any thing except ch=13 (ascii value)
		clrscr();
		cout<<"\t\t  "<<"________________________________________"<<endl;
		cout<<endl<<"\t\t\t  "<<"Welcome\t"<<temp.retname()<<" !!"<<endl;
		cout<<"\t\t  "<<"________________________________________"<<endl;
		cout<<endl<<"Enter your choice :-(Use < or > to navigate) "<<endl;
		cout<<"1. Borrow a cd         <==== "<<endl;
		cout<<"2. Return a cd               "<<endl;
		cout<<"3. My account                "<<endl;
		cout<<"4. Log out                   "<<endl;

		while((int)ch!=13)
		{ ch=getch();
		  if((int)ch==13)
		  break;
		  if((int)ch==44)     //move arrow up
		  { if(ctr==1)
		    ctr=4;
		    else
		    ctr--;
		  }
		  if((int)ch==46)     //move arrow down
		  { if(ctr==4)
		    ctr=1;
		    else
		    ctr++;
		  }
		  if(ctr==1)
		   { clrscr();
		     cout<<"\t\t  "<<"________________________________________"<<endl;
		     cout<<endl<<"\t\t\t  "<<"Welcome\t"<<temp.retname()<<" !!"<<endl;
		     cout<<"\t\t  "<<"________________________________________"<<endl;
		     cout<<endl<<"Enter your choice :-(Use < or > to navigate) "<<endl;
		     cout<<"1. Borrow a cd         <==== "<<endl;
		     cout<<"2. Return a cd               "<<endl;
		     cout<<"3. My account                "<<endl;
		     cout<<"4. Log out                   "<<endl;
		   }
		  if(ctr==2)
		   { clrscr();
		     cout<<"\t\t  "<<"________________________________________"<<endl;
		     cout<<endl<<"\t\t\t  "<<"Welcome\t"<<temp.retname()<<" !!"<<endl;
		     cout<<"\t\t  "<<"________________________________________"<<endl;
		     cout<<endl<<"Enter your choice :-(Use < or > to navigate) "<<endl;
		     cout<<"1. Borrow a cd               "<<endl;
		     cout<<"2. Return a cd         <==== "<<endl;
		     cout<<"3. My account                "<<endl;
		     cout<<"4. Log out                   "<<endl;

		   }
		  if(ctr==3)
		   { clrscr();
		     cout<<"\t\t  "<<"________________________________________"<<endl;
		     cout<<endl<<"\t\t\t  "<<"Welcome\t"<<temp.retname()<<" !!"<<endl;
		     cout<<"\t\t  "<<"________________________________________"<<endl;
		     cout<<endl<<"Enter your choice :-(Use < or > to navigate) "<<endl;
		     cout<<"1. Borrow a cd               "<<endl;
		     cout<<"2. Return a cd               "<<endl;
		     cout<<"3. My account          <==== "<<endl;
		     cout<<"4. Log out                   "<<endl;
		   }
		  if(ctr==4)
		   { clrscr();
		     cout<<"\t\t  "<<"________________________________________"<<endl;
		     cout<<endl<<"\t\t\t  "<<"Welcome\t"<<temp.retname()<<" !!"<<endl;
		     cout<<"\t\t  "<<"________________________________________"<<endl;
		     cout<<endl<<"Enter your choice :-(Use < or > to navigate) "<<endl;
		     cout<<"1. Borrow a cd               "<<endl;
		     cout<<"2. Return a cd               "<<endl;
		     cout<<"3. My account                "<<endl;
		     cout<<"4. Log out             <==== "<<endl;
		   }

		}
		choice=ctr;
		ctr=1;

	    if(choice==1)
	    {
	     if(strcmpi("[~~NULL~~]",temp.borrow)==0)
	     {	 clrscr();
		 int c1=0;
		 cout<<"\t\t  "<<"________________________________________"<<endl;
		 cout<<endl<<"\t\t\t      "<<"start your search:"<<endl;
		 cout<<"\t\t  "<<"________________________________________"<<endl<<endl;
		 cout<<"\t\t  "<<"                        powered by search engine v1.0\n\n";
		 ch=(char)8;
		 while((int)ch==8||(int)ch==13)
		 ch=getch();    //makes sure that back space is not taken as input for search engine
		 sch[c1]=ch;

		 while(1)
		 {clrscr();
		  c1++;
		  sch[c1]='\0';
		  cout<<"\t\t  "<<"________________________________________"<<endl;
		  cout<<endl<<"\t\t\t      "<<sch<<"_"<<endl;
		  cout<<"\t\t  "<<"________________________________________"<<endl<<endl;
		  cout<<"navigate using < or > keys...\n\n";
		  search(sch);
		  if(f==0)
		  {
		  if((char)ret!=8)
		  sch[c1]=ret;
		  else
		  c1-=2;
		  }
		  else if(f==1)
		  { clrscr();

		   strcpy(temp.borrow,mreturn);
		   cout<<"\t\t  "<<"________________________________________"<<endl;
		   cout<<endl<<"\t\tHired the cd :      "<<temp.borrow<<endl;
		   cout<<"\t\t  "<<"________________________________________"<<endl<<endl;
		   cout<<"\t\t  Today's date is :";
		   master.showdate();
		   temp.bdate=master.getdate();
		   cout<<"\n\n\t\t  You have 20 days before penalty charges may apply";
		   rewrite(temp,a.tellg());
		   break;
		  }


		 }

	     }
	     else
	     {
	     cout<<"\t___________________________________________________\n\n";
	     cout<<"\tReturn the hired cd before hiring a new one\n";
	     cout<<"\t___________________________________________________\n";
	     getch();
	     }
	    }
	    else if(choice==2)
	    {                     char rep='n';
				  clrscr();
				  cout<<"\n\n";
				  cout<<"              DETAILS OF THE LAST CD HIRED :             "<<endl;
				  cout<<"|-------------------------------------------------------|"<<"\n";
				  cout<<"| The hired CD is                  : "<<setw(19)<<temp.borrow<<"|"<<endl;
				  cout<<"| Date of borrow                   : ";
				  temp.bdate.display();
				  cout<<setw(9)<<" "<<"|\n";
				  cout<<"| No. of days left before penalty  : "<<setw(19);

				  if((20 -temp.diff(master.getdate(),temp.bdate))>=0)
				  cout<<(20-temp.diff(master.getdate(),temp.bdate))<<"|";
				  else
				  {
				  cout<<"ellapsed"<<"|"<<endl;
				  cout<<"| Applicable penalty charges       : Rs."<<setw(16)<<((temp.diff(master.getdate(),temp.bdate)-20)*10)<<"|";

				  }
				  cout<<"\n|-------------------------------------------------------|"<<"\n\n";
				  cout<<"Do you want to return the cd ??(y/n)";
				  cin>>rep;
				  if(rep=='y')
				  { temp.rdate=master.getdate();
				    if(temp.diff(temp.rdate,temp.bdate)>20)
				    {
				    clrscr();
				    master.profit((temp.diff(temp.rdate,temp.bdate)-20),temp.borrow,'p');
				    }
				    cout<<"Thanks for using cd library"<<endl;
				    strcpy(temp.borrow,"[~~NULL~~]");
				    //we should increment the qty.
				    rewrite(temp,a.tellg());
				  }
				  getch();
	    }
	    else if(choice==3)
	    while(1)
	    {   char f='n',ch;
		clrscr();
		cout<<"\t\t  "<<"________________________________________"<<endl;
		cout<<endl<<"\t\t\t  "<<"Account Settings !!"<<endl;
		cout<<"\t\t  "<<"________________________________________"<<endl;
		cout<<endl<<"Enter your choice :-(Use < or > to navigate) "<<endl;
		cout<<"1. View/Edit           <==== "<<endl;
		cout<<"2. Deactivate                "<<endl;
		cout<<"3. Done                      "<<endl;
		ch='a';
		ctr1=1;
		choice1=0;
		while((int)ch!=13)
		 {
		  ch=getch();
		  if((int)ch==13)
		  break;
		   if((int)ch==44)     //move arrow up
		   { if(ctr1==1)
		     ctr1=3;
		     else
		     ctr1--;
		   }
		   if((int)ch==46)     //move arrow down
		   { if(ctr1==3)
		     ctr1=1;
		     else
		     ctr1++;
		   }
		   if(ctr1==1)
		    { clrscr();
		      cout<<"\t\t  "<<"________________________________________"<<endl;
		      cout<<endl<<"\t\t\t  "<<"Account Settings !!"<<endl;
		      cout<<"\t\t  "<<"________________________________________"<<endl;
		      cout<<endl<<"Enter your choice :-(Use < or > to navigate) "<<endl;
		      cout<<"1. View/Edit           <==== "<<endl;
		      cout<<"2. Deactivate                "<<endl;
		      cout<<"3. Done                      "<<endl;
		    }
		   if(ctr1==2)
		    { clrscr();
		      cout<<"\t\t  "<<"________________________________________"<<endl;
		      cout<<endl<<"\t\t\t  "<<"Account Settings !!"<<endl;
		      cout<<"\t\t  "<<"________________________________________"<<endl;
		      cout<<endl<<"Enter your choice :-(Use < or > to navigate) "<<endl;
		      cout<<"1. View/Edit                 "<<endl;
		      cout<<"2. Deactivate          <==== "<<endl;
		      cout<<"3. Done                      "<<endl;
		    }
		   if(ctr1==3)
		   { clrscr();
		      cout<<"\t\t  "<<"________________________________________"<<endl;
		      cout<<endl<<"\t\t\t  "<<"Account Settings !!"<<endl;
		      cout<<"\t\t  "<<"________________________________________"<<endl;
		      cout<<endl<<"Enter your choice :-(Use < or > to navigate) "<<endl;
		      cout<<"1. View/Edit                 "<<endl;
		      cout<<"2. Deactivate                "<<endl;
		      cout<<"3. Done                <==== "<<endl;
		   }

		}
		 choice1=ctr1;
		 ctr1=1;

		 if(choice1==1)
		 {
		  temp.edit();
		  rewrite(temp,a.tellg());
		 }
		 if(choice1==2)
		 {
		    if(temp.deactivate=='n')
		    {
		    cout<<"account is activated - do you want to deactivate ?? (y/n)";
		    cin>>f;
		    }
		    if(f=='y')
		    {
		    temp.deactivate='y';
		    rewrite(temp,a.tellg());
		    cout<<"your account was deactivated right now";
		    }
		    if (temp.deactivate=='y')
		    cout<<"your account is already deactivated";
		 }
		 if(choice1==3)
		 {
		  break;
		 }


	    } //end of while(1)
	    else if(choice==4)
	    {
	    a.close();
	    return;
	    }
	  }
	}
	}
	else
	{
	cout<<"user id not found !!!!";
	a.close();
	getch();
	}
}
/*____________________________________________________________________________
  ____________________________________________________________________________

	      /*--------------------------------------------
		  Function to perform administrative tasks
		--------------------------------------------*/

void admin()
{     char pin[10];
      // Enter admin password

      cout<<endl<<endl<<"\t     \t"<<"Enter administrator password  : ";

      for(int i=0;i<5;i++)
      {
      pin[i]=getch();

      if((int)pin[i]==8)      ////////////////////////////////////////
      {                       // This statement gives compatability //
	if(i>0)               //          for backspaces            //
	{                     ////////////////////////////////////////
	 cout<<"\b \b";
	 i--;             // To delete the previous charachter
	}
      i--;                // Cursor must not be moved if backspace is entered
      }
      else
      cout<<"*";
      }
      pin[i]='\0';


     if(strcmpi(pin,"admin")!=0)
     {clrscr();
      cout<<"\n\n\n\n";
      cout<<"\t\t  "<<"________________________________________"<<endl;
      cout<<endl<<"\t\t\t  "<<"Access  forbidden  !!!!!"<<endl;
      cout<<"\t\t  "<<"________________________________________"<<endl<<endl;
      getch();
      return;
     }
     else
   { int choice;
     int ctr=1;
     char ch;
     while(1)
	{       /*--------------------------------------------
		      CREATES THE Graphical User Interface
				  for admin
		  --------------------------------------------*/
		ch='a';  //This can be any thing except ch=13 (ascii value)
		clrscr();
		cout<<"\t\t  "<<"________________________________________"<<endl;
		cout<<endl<<"\t\t\t  "<<"Perform admin tasks !!"<<endl;
		cout<<"\t\t  "<<"________________________________________"<<endl;
		cout<<endl<<"Enter your choice :-(Use < or > to navigate) "<<endl;
		cout<<"1. Display all users    <==== "<<endl;
		cout<<"2. Delete all users	     "<<endl;
		cout<<"3. Profit report              "<<endl;
		cout<<"4. Manage songs               "<<endl;
		cout<<"5. Set date                   "<<endl;
		cout<<"6. Exit admin tools           "<<endl;
		while((int)ch!=13)
		{ ch=getch();
		  if((int)ch==13)
		  break;
		  if((int)ch==44)     //move arrow up
		  { if(ctr==1)
		    ctr=6;
		    else
		    ctr--;
		  }
		  if((int)ch==46)     //move arrow down
		  { if(ctr==6)
		    ctr=1;
		    else
		    ctr++;
		  }
		  if(ctr==1)
		   {
			clrscr();
			cout<<"\t\t  "<<"________________________________________"<<endl;
			cout<<endl<<"\t\t\t  "<<"Perform admin tasks !!"<<endl;
			cout<<"\t\t  "<<"________________________________________"<<endl;
			cout<<endl<<"Enter your choice :-(Use < or > to navigate) "<<endl;
			cout<<"1. Display all users    <==== "<<endl;
			cout<<"2. Delete all users	     "<<endl;
			cout<<"3. Profit report              "<<endl;
			cout<<"4. Manage songs               "<<endl;
			cout<<"5. Set date                   "<<endl;
			cout<<"6. Exit admin tools           "<<endl;

		   }
		  if(ctr==2)
		   {
			clrscr();
			cout<<"\t\t  "<<"________________________________________"<<endl;
			cout<<endl<<"\t\t\t  "<<"Perform admin tasks !!"<<endl;
			cout<<"\t\t  "<<"________________________________________"<<endl;
			cout<<endl<<"Enter your choice :-(Use < or > to navigate) "<<endl;
			cout<<"1. Display all users          "<<endl;
			cout<<"2. Delete all users     <==== "<<endl;
			cout<<"3. Profit report              "<<endl;
			cout<<"4. Manage songs               "<<endl;
			cout<<"5. Set date                   "<<endl;
			cout<<"6. Exit admin tools           "<<endl;

		   }
		  if(ctr==3)
		   {
			clrscr();
			cout<<"\t\t  "<<"________________________________________"<<endl;
			cout<<endl<<"\t\t\t  "<<"Perform admin tasks !!"<<endl;
			cout<<"\t\t  "<<"________________________________________"<<endl;
			cout<<endl<<"Enter your choice :-(Use < or > to navigate) "<<endl;
			cout<<"1. Display all users          "<<endl;
			cout<<"2. Delete all users	     "<<endl;
			cout<<"3. Profit report        <==== "<<endl;
			cout<<"4. Manage songs               "<<endl;
			cout<<"5. Set date                   "<<endl;
			cout<<"6. Exit admin tools           "<<endl;

		   }
		  if(ctr==4)
		   {
			clrscr();
			cout<<"\t\t  "<<"________________________________________"<<endl;
			cout<<endl<<"\t\t\t  "<<"Perform admin tasks !!"<<endl;
			cout<<"\t\t  "<<"________________________________________"<<endl;
			cout<<endl<<"Enter your choice :-(Use < or > to navigate) "<<endl;
			cout<<"1. Display all users          "<<endl;
			cout<<"2. Delete all users           "<<endl;
			cout<<"3. Profit report              "<<endl;
			cout<<"4. Manage songs         <==== "<<endl;
			cout<<"5. Set date                   "<<endl;
			cout<<"6. Exit admin tools           "<<endl;
		   }
		 if(ctr==5)
		   {
			clrscr();
			cout<<"\t\t  "<<"________________________________________"<<endl;
			cout<<endl<<"\t\t\t  "<<"Perform admin tasks !!"<<endl;
			cout<<"\t\t  "<<"________________________________________"<<endl;
			cout<<endl<<"Enter your choice :-(Use < or > to navigate) "<<endl;
			cout<<"1. Display all users          "<<endl;
			cout<<"2. Delete all users           "<<endl;
			cout<<"3. Profit report              "<<endl;
			cout<<"4. Manage songs               "<<endl;
			cout<<"5. Set date             <==== "<<endl;
			cout<<"6. Exit admin tools           "<<endl;

		   }
		 if(ctr==6)
		   {
			clrscr();
			cout<<"\t\t  "<<"________________________________________"<<endl;
			cout<<endl<<"\t\t\t  "<<"Perform admin tasks !!"<<endl;
			cout<<"\t\t  "<<"________________________________________"<<endl;
			cout<<endl<<"Enter your choice :-(Use < or > to navigate) "<<endl;
			cout<<"1. Display all users          "<<endl;
			cout<<"2. Delete all users           "<<endl;
			cout<<"3. Profit report              "<<endl;
			cout<<"4. Manage songs               "<<endl;
			cout<<"5. Set date                   "<<endl;
			cout<<"6. Exit admin tools     <==== "<<endl;

		   }

		} //end of (int)ch!=13
		choice=ctr;
		ctr=1;
		  switch(choice)
		{
			case 1:
				{ int ctr;
				  ctr=0;
				  if(n==0)
				  {
				  cout<<"no users!!";
				  clrscr();
				  return;
				  }
				  clrscr();
				  fstream a;
				  store temp;
				  a.open("users.dat",ios::binary|ios::in);
				   while(!a.eof())
				 {
				  a.read((char*)&temp,sizeof(temp));
				  if(a.eof()==1)
				  {
				   break;
				  }
				  ctr++;

				  cout<<"\t\t  "<<"________________________________________"<<endl;
				  cout<<endl<<"\t\t\t"<<"User"<<ctr<<"    [total of "<<n<<" users ]"<<endl;
				  cout<<"\t\t  "<<"________________________________________"<<endl;

				  temp.display('a');
				  cout<<"hit any key to continue";
				  getch();
				  clrscr();
				 }
				}
			break;
			case 2:
				{char choice;
				 cout<<" you sure u wanna delete all users?? (y/n) :";
				 cin>>choice;
				 if(choice=='y')
				 {
				 remove("users.dat");
				 cout<<"removed all users !!!";
				 }
				 getch();
				 clrscr();
				}
			break;
			case 3:
				{ clrscr();
				  cout<<"\n\n\n\n";
				  cout<<"\t\t  "<<"    ________________________________________"<<endl;
				  cout<<endl<<"\t\t\t"<<"            PROFIT REPORT !!          "<<endl;
				  cout<<"\t\t  "<<"    ________________________________________"<<endl;
				  cout<<"\n\n"<<"The Cd library has currently "<<n<<" member in its database\n";
				  cout<<"\n"  <<"The Cd library has currently "<<m<<" titles\n";
				  master.showprofit();
				  getch();
				}
			break;
			case 4:
			while(1)
			{
				int x,ctr5=1;
				char ch;
			       //	 cout<<"delete: \n1.all songs\n"<<"2.specific song(s)\nchoice: ";
			       //	 cin>>x;



				 clrscr();
		cout<<"\t\t  "<<"________________________________________"<<endl;
		cout<<endl<<"\t\t\t\t  "<<"Manage songs !!"<<endl;
		cout<<"\t\t  "<<"________________________________________"<<endl;
		cout<<endl<<"Enter your choice :-(Use < or > to navigate) "<<endl;
		cout<<"1. Add a new cd to the library     <==== "<<endl;
		cout<<"2. Delete specific song(s)               "<<endl;
		cout<<"3. Delete all songs                      "<<endl;
		cout<<"4. Return to admin tools                 "<<endl;
		ch='a';
		while((int)ch!=13)
		{ ch=getch();
		  if((int)ch==13)
		  break;
		  if((int)ch==44)     //move arrow up
		  { if(ctr5==1)
		    ctr5=4;
		    else
		    ctr5--;
		  }
		  if((int)ch==46)     //move arrow down
		  { if(ctr5==4)
		    ctr5=1;
		    else
		    ctr5++;
		  }
		  if(ctr5==1)
		   { clrscr();
		     cout<<"\t\t  "<<"________________________________________"<<endl;
		     cout<<endl<<"\t\t\t\t  "<<"Manage songs !!"<<endl;
		     cout<<"\t\t  "<<"________________________________________"<<endl;
		     cout<<endl<<"Enter your choice :-(Use < or > to navigate) "<<endl;
		     cout<<"1. Add a new cd to the library     <==== "<<endl;
		     cout<<"2. Delete specific song(s)               "<<endl;
		     cout<<"3. Delete all songs                      "<<endl;
		     cout<<"4. Return to admin tools                 "<<endl;

		   }
		  if(ctr5==2)
		   { clrscr();
		     cout<<"\t\t  "<<"________________________________________"<<endl;
		     cout<<endl<<"\t\t\t\t  "<<"Manage songs !!"<<endl;
		     cout<<"\t\t  "<<"________________________________________"<<endl;
		     cout<<endl<<"Enter your choice :-(Use < or > to navigate) "<<endl;

		     cout<<"1. Add a new cd to the library           "<<endl;
		     cout<<"2. Delete specific song(s)         <==== "<<endl;
		     cout<<"3. Delete all songs                      "<<endl;
		     cout<<"4. Return to admin tools                 "<<endl;

		   }
		  if(ctr5==3)
		   { clrscr();
		     cout<<"\t\t  "<<"________________________________________"<<endl;
		     cout<<endl<<"\t\t\t\t  "<<"Manage songs !!"<<endl;
		     cout<<"\t\t  "<<"________________________________________"<<endl;
		     cout<<endl<<"Enter your choice :-(Use < or > to navigate) "<<endl;
		     cout<<"1. Add a new cd to the library           "<<endl;
		     cout<<"2. Delete specific song(s)               "<<endl;
		     cout<<"3. Delete all songs                <==== "<<endl;
		     cout<<"4. Return to admin tools                 "<<endl;

		   }
		  if(ctr5==4)
		   { clrscr();
		     cout<<"\t\t  "<<"________________________________________"<<endl;
		     cout<<endl<<"\t\t\t\t  "<<"Manage songs !!"<<endl;
		     cout<<"\t\t  "<<"________________________________________"<<endl;
		     cout<<endl<<"Enter your choice :-(Use < or > to navigate) "<<endl;
		     cout<<"1. Add a new cd to the library           "<<endl;
		     cout<<"2. Delete specific song(s)               "<<endl;
		     cout<<"3. Delete all songs                      "<<endl;
		     cout<<"4. Return to admin tools           <==== "<<endl;

		   }

		}
		x=ctr5;
		ctr5=1;

				  if(x==1)
				  {
				  song.accept();
				  msave(song);
				  }


				  if(x==2)
				  {     clrscr();
					char sch[50];
					int c1=0;
					cout<<"\t\t  "<<"________________________________________"<<endl;
					cout<<endl<<"\t\t\t      "<<"start your search:"<<endl;
					cout<<"\t\t  "<<"________________________________________"<<endl<<endl;
					ch=(char)8;
					while((int)ch==8||(int)ch==13)    //makes sure that enter or backspace is not taken as input for search engine
					ch=getch();
					sch[c1]=ch;

					while(1)
					{clrscr();
					 c1++;
					 sch[c1]='\0';
					 cout<<"\t\t  "<<"________________________________________"<<endl;
					 cout<<endl<<"\t\t\t      "<<sch<<"_"<<endl;
					 cout<<"\t\t  "<<"________________________________________"<<endl<<endl;
					 cout<<"navigate using < or > keys...\n\n";
					 search(sch,'a');
					if(f==0)
					{
					 if((int)ret!=8)
					 sch[c1]=ret;
					 else
					 c1-=2;
					}
					 else if(f==1)
					 break;
					}

				  }
				  if(x==3)
				  {char ch='n';
				   cout<<"Are you sure that you want to delete all songs ??(Y/N)";
				   cin>>ch;
				   if(ch=='y')
				   {
				   remove("music.dat");
				   cout<<"removed all songs !!!";
				   }
				   getch();
				   clrscr();
				  }

				  if(x==4)
				  break;

				}
			break;
			case 5: {char reply;
				 clrscr();
				 cout<<"\t\t  "<<"________________________________________"<<endl;
				 cout<<endl<<"\t\t\t      "<<"Settings --->Date "<<endl;
				 cout<<"\t\t  "<<"________________________________________"<<endl<<endl;
				 cout<<"\n\t\t  "<<"The current system date is:";
				 master.showdate();
				 cout<<"\n\n\t\t  "<<"Do you want to adjust the date ?? (y/n) > <\b\b";
				 reply=getche();
				 if(reply=='y')
				 {
				 cout<<"\n\n\t\t  "<<"Set Today's date :";
				 master.setdate();
				 }
				}
				break;
			case 6:
				{
				return;
				}
			default :cout<<"Wrong Choice";
		}//end of switch


	} //end of rep==y
   }      //end of else
}         //end of function admin




void main()
{       clrscr();

	obtain();
	int choice;
	int ctr=1;
	char ch;
	while(1)
	{       /*--------------------------------------------
		      CREATES THE Graphical User Interface
		  --------------------------------------------*/
		ch='a';  //This can be any thing except ch=13 (ascii value)
		clrscr();
		cout<<"\t\t  "<<"________________________________________"<<endl;
		cout<<endl<<"\t\t\t  "<<"Welcome to CD library !!"<<endl;
		cout<<"\t\t  "<<"________________________________________"<<endl;
		cout<<endl<<"Enter your choice :-(Use < or > to navigate) "<<endl;
		cout<<"1. Register     <==== "<<endl;
		cout<<"2. Login              "<<endl;
		cout<<"3. Admin tools        "<<endl;
		cout<<"4. Exit               "<<endl;

		while((int)ch!=13)
		{ ch=getch();
		  if((int)ch==13)
		  break;
		  if((int)ch==44)     //move arrow up
		  { if(ctr==1)
		    ctr=4;
		    else
		    ctr--;
		  }
		  if((int)ch==46)     //move arrow down
		  { if(ctr==4)
		    ctr=1;
		    else
		    ctr++;
		  }
		  if(ctr==1)
		   { clrscr();
		     cout<<"\t\t  "<<"________________________________________"<<endl;
		     cout<<endl<<"\t\t\t  "<<"Welcome to CD library !!"<<endl;
		     cout<<"\t\t  "<<"________________________________________"<<endl;
		     cout<<endl<<"Enter your choice :-(Use < or > to navigate) "<<endl;
		     cout<<"1. Register     <==== "<<endl;
		     cout<<"2. Login              "<<endl;
		     cout<<"3. Admin tools        "<<endl;
		     cout<<"4. Exit               "<<endl;
		   }
		  if(ctr==2)
		   { clrscr();
		     cout<<"\t\t  "<<"________________________________________"<<endl;
		     cout<<endl<<"\t\t\t  "<<"Welcome to CD library !!"<<endl;
		     cout<<"\t\t  "<<"________________________________________"<<endl;
		     cout<<endl<<"Enter your choice :-(Use < or > to navigate) "<<endl;

		     cout<<"1. Register           "<<endl;
		     cout<<"2. Login        <==== "<<endl;
		     cout<<"3. Admin tools        "<<endl;
		     cout<<"4. Exit               "<<endl;

		   }
		  if(ctr==3)
		   { clrscr();
		     cout<<"\t\t  "<<"________________________________________"<<endl;
		     cout<<endl<<"\t\t\t  "<<"Welcome to CD library !!"<<endl;
		     cout<<"\t\t  "<<"________________________________________"<<endl;
		     cout<<endl<<"Enter your choice :-(Use < or > to navigate) "<<endl;
		     cout<<"1. Register           "<<endl;
		     cout<<"2. Login              "<<endl;
		     cout<<"3. Admin tools  <==== "<<endl;
		     cout<<"4. Exit               "<<endl;
		   }
		  if(ctr==4)
		   { clrscr();
		     cout<<"\t\t  "<<"________________________________________"<<endl;
		     cout<<endl<<"\t\t\t  "<<"Welcome to CD library !!"<<endl;
		     cout<<"\t\t  "<<"________________________________________"<<endl;
		     cout<<endl<<"Enter your choice :-(Use < or > to navigate) "<<endl;
		     cout<<"1. Register           "<<endl;
		     cout<<"2. Login              "<<endl;
		     cout<<"3. Admin tools        "<<endl;
		     cout<<"4. Exit         <==== "<<endl;
		   }

		}
		choice=ctr;
		ctr=1;
		/*----------------------------------------------
		       Switching Control to various functions

			  from the data entered in the GUI
		  ----------------------------------------------*/
		  switch(choice)
		{
			case 1:
				{	clrscr();
					cout<<"\t\t  "<<"________________________________________"<<endl;
					cout<<endl<<"\t\t  "<<"          REGISTRATION PORTAL"<<endl;
					cout<<"\t\t  "<<"________________________________________"<<endl;
					n++;
					s.accept();
					save(s);
				}
			break;
			case 2:
			{ clrscr();
				cout<<"\t\t  "<<"________________________________________"<<endl;
			  cout<<endl<<"\t\t  "<<"                 LOGIN"<<endl;
				cout<<"\t\t  "<<"________________________________________"<<endl;
				char id[10],pass[10];
				cout<<"\t\tEnter the following credentials"<<endl;
				cout<<endl<<"\t\t\t"<<"Enter your 10-digit user id\t: ";
				cin>>id;
     // Enter the password -----------------------------------------------
				cout<<endl<<"\t\t\t"<<"Enter 5 digit pin          \t: ";
				for(int i=0;i<5;i++)
				{
				 pass[i]=getch();

				 if((int)pass[i]==8)    ////////////////////////////////////////
				 {                       // This statement gives compatability //
				   if(i>0)               //          for backspaces            //
				   {                     ////////////////////////////////////////
				   cout<<"\b \b";
				   i--;             // To delete the previous charachter
				   }
				 i--;                // Cursor must not be moved if backspace is entered
				 }
				 else
				 cout<<"*";
				}
				  pass[i]='\0';

				existing(id,pass);
     //                    ------------------------------------------------------------
			}
			break;
			case 3: //Admin tools
			{
			admin();
			break;
			}
			case 4:exit(1);
			default :cout<<"Wrong Choice";
		}
		cout<<endl;

	}
}